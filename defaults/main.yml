---

harden_logcheck: true
#harden_logcheck_hours: '*'
harden_logcheck_hours: '6,18'
harden_use_rpc: false
harden_use_forwarding: false
harden_umask: '022'
#harden_umask: '027'
harden_aide: true
harden_init_aidedb: false
harden_aidedb_rotatedays: 14
harden_arpwatch: true
harden_unix_fstab_flags: true
harden_logindefs_pass_maxdays: 182
harden_logindefs_pass_warnage: 30
harden_shell_timeout: 900
harden_sshd_port: 22
## You might also want to review harden_sshd_crypto in vars/{{distro}}.yml
## will break 'vagrant up' ssh detection (vagrant ssh fine): use second line for MACs
harden_sshd_PasswordAuthentication: false

harden_journald_systemmaxuse: '1024M'
harden_logrotate_days: 90

harden_disable_usb: true
harden_enable_iommu_force: false

harden_bash2syslog: true

harden_upgradeall: true
harden_use_containers_lxc: false

## add email to /root/.forward?
#harden_rootforward: email

harden_restrict_compiler: true
harden_restrict_compiler_umask: '0700'
#harden_restrict_compiler_umask: '0750'
harden_restrict_compiler_group: 'root'

harden_logcheck_extra_logfiles:
  - /var/log/fail2ban.log
  - /var/log/supervisor/supervisord.log

harden_fail2ban_ignoreip: 127.0.0.1 192.168.1.0/24 10.0.0.0/8 8.8.8.8 8.8.4.4

harden_auditd_log_tmp: true
harden_auditd_log_etc: true
## Attention! those three would generate lot of logs. alternatives: sysdig/falco, systemtap, osquery...
harden_auditd_log_all_execve: false
harden_auditd_log_all_socket: false
harden_auditd_log_all_connect: false
harden_auditd_sensitive_files:
  - /etc/shadow
## file must exist
#  - /data/topsecret.data
harden_auditd_extra_rules: []

## firewall rules? avoid to lock yourself
#harden_fw: false
harden_fw: true
harden_fw_template: rules.v4.j2
## Note: in default config, if you switch default policy to drop, you will lose access...
#harden_fw_default: DROP
harden_fw_default: ACCEPT
harden_fw_gw: 192.168.1.1
harden_fw_ssh_restricted:
  - 192.168.1.0/24
  - 10.0.0.0/8
  - 1.1.1.1
harden_fw_ssh_port: 22
harden_fw_snmp_restricted:
  - 192.168.1.100
harden_fw_dnsservers:
  - 192.168.1.10
  - 192.168.1.11
  - 8.8.8.8
  - 8.8.4.4
harden_fw_smtpservers:
  - 192.168.1.20
harden_fw_smtp_port: 25
harden_fw_open_incoming:
  - { proto: 'tcp', port: 8080 }
  - { proto: 'tcp', port: 9091 }
## FIXME! open all or more? security can be split between VA scan, IR, ...
#harden_fw_security_source:

### Monitoring
## can use inventory group but
##  only possible if cache facts or talk with host in same play
##  http://docs.ansible.com/ansible/playbooks_variables.html#fact-caching
## OR define here
#harden_fw_monitoring_source:
## also review templates/rules.v4 as you might need specific flows for your setup

## Apport has been found to many vulnerabilities. Same for Fedora abrt
## https://bugs.launchpad.net/ubuntu/+source/apport/+bug/1507480
## http://www.openwall.com/lists/oss-security/2015/04/14/4
## http://www.halfdog.net/Security/2015/ApportKernelCrashdumpFileAccessVulnerabilities/
## https://wiki.ubuntu.com/Apport#Why_is_it_disabled.3F
## https://access.redhat.com/solutions/61536
harden_linux_disable_bugreport: true

harden_ubuntu_livepatch: false
harden_ubuntu_livepatch_token: 'xxx'

harden_osquery: true
harden_osquery_template: 'osquery.conf.j2'
harden_osquery_upload_packs: []
harden_osquery_packs:
    - "osquery-monitoring"
    - "incident-response"
    - "it-compliance"
## FIXME! bugs in osx-attacks, and vuln-management
#    - "osx-attacks"
#    - "vuln-management"
    - "hardware-monitoring"
harden_osquery_flags: []
## if using zentral, kolide or else
## https://github.com/zentralopensource/zentral/blob/f460b10a95d4ea1e515aea3363f55733465d1d9c/zentral/contrib/osquery/deb_script/template.sh
## https://docs.kolide.co/kolide/current/infrastructure/adding-hosts-to-kolide.html
#harden_osquery_flags:
#    - { re: '^--enroll_secret_env=.*', l: '--enroll_secret_env=OSQUERY_ENROLL_SECRET' }
#    - { re: '^--tls_server_certs=.*', l: '--tls_server_certs=/etc/osquery/kolide.crt' }
#    - { re: '^--tls_hostname=.*', l: '--tls_hostname=acme.kolide.co' }
#    - { re: '^--host_identifier=.*', l: '--host_identifier=hostname' }
#    - { re: '^--enroll_tls_endpoint=.*', l: '--enroll_tls_endpoint=/api/v1/osquery/enroll' }
#    - { re: '^--config_plugin=.*', l: '--config_plugin=tls' }
#    - { re: '^--config_tls_endpoint=.*', l: '--config_tls_endpoint=/api/v1/osquery/config' }
#    - { re: '^--config_tls_refresh=.*', l: '--config_tls_refresh=10' }
#    - { re: '^--disable_distributed=.*', l: '--disable_distributed=false' }
#    - { re: '^--distributed_plugin=.*', l: '--distributed_plugin=tls' }
#    - { re: '^--distributed_interval=.*', l: '--distributed_interval=10' }
#    - { re: '^--distributed_tls_max_attempts=.*', l: '--distributed_tls_max_attempts=3' }
#    - { re: '^--distributed_tls_read_endpoint=.*', l: '--distributed_tls_read_endpoint=/api/v1/osquery/distributed/read' }
#    - { re: '^--distributed_tls_write_endpoint=.*', l: '--distributed_tls_write_endpoint=/api/v1/osquery/distributed/write' }
#    - { re: '^--logger_plugin=.*', l: '--logger_plugin=tls' }
#    - { re: '^--logger_tls_endpoint=.*', l: '--logger_tls_endpoint=/api/v1/osquery/log' }
#    - { re: '^--logger_tls_period=.*', l: '--logger_tls_period=10' }

harden_osquery_fim: true
harden_osquery_rsyslog: false
## conflict with auditd. choose one.
## https://osquery.readthedocs.io/en/stable/deployment/process-auditing/
harden_osquery_process_auditing: false

_ubuntu_sysctl:

## define in vars/{{ distribution }}*.yml
harden_debian_pkg: []
harden_debian_remove: []

## maybe override in vars/{{ distribution }}*.yml and disabled on lxc as parts are not permitted
harden_distribution_sysctl:

## FIXME! changed: [dpjenkins] => (item={u'uuid': u'd39864c2-d249-4a0c-b885-5c72ef360b3f', u'size_total': 42142052352, u'mount': u'/var/lib/lxd/shmounts', u'size_available': 22098018304, u'fstype': u'ext4', u'device': u'/dev/vda1', u'options': u'rw,relatime,data=ordered,bind'})
harden_mount_options:
    "/": "defaults"
    "/boot": "defaults,nosuid,nodev,noexec"
    "/home": "defaults,nosuid,nodev"
#    "/home": "defaults,nosuid,nodev,noexec"
    "/tmp": "defaults,nosuid,nodev,noexec"
    "/usr": "defaults,ro,nodev"
    "/var/log/audit": "defaults,nosuid,nodev,noexec"
    "/var/log": "defaults,nosuid,nodev,noexec"
    "/var/tmp": "defaults,nosuid,nodev,noexec"
    "/var": "defaults,nosuid"
    "/dev/shm": "defaults,nosuid,nodev,noexec"
    "/run/shm": "defaults,nosuid,nodev,noexec"
## https://linux-audit.com/linux-system-hardening-adding-hidepid-to-proc/
#    "/proc": "rw,nosuid,nodev,noexec,relatime,hidepid=2"
    "/opt": "defaults,nosuid,nodev"

harden_mount_options_aptpre:
    "/tmp": "exec"
    "/var/tmp": "exec"
    "/usr": "rw"

harden_mount_options_aptpost:
    "/tmp": "noexec"
    "/var/tmp": "noexec"
    "/usr": "ro"

## Experimental
harden_usb_restrict_udev: false
harden_usb_blockdevice_whitelist:
  - 'ATTR{idVendor}=="5572",ATTR{idProduct}=="123456",ATTR{serial}=="XXX"'
harden_usb_inputdevice_whitelist:
## Microsoft Wired keyboard 400
  - 'ATTR{idVendor}=="045e",ATTR{idProduct}=="0752",ATTR{urbnum}=="2175"'

monit_auditd: false
monit_osqueryd: false
